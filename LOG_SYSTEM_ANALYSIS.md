# Log ç³»çµ±æž¶æ§‹åˆ†æž

## ðŸ“‹ æ¦‚è¿°

æœ¬å°ˆæ¡ˆä½¿ç”¨å®Œæ•´çš„ Log ç³»çµ±ï¼Œå°‡æ‰€æœ‰æ“ä½œè¨˜éŒ„åˆ° Google Sheets çš„ã€ŒLogã€å·¥ä½œè¡¨ï¼Œä¸¦åŒæ­¥è¼¸å‡ºåˆ° Apps Script Loggerã€‚

---

## ðŸ—ï¸ æž¶æ§‹çµ„æˆ

### 1. Log ç­‰ç´šå®šç¾©ï¼ˆLOG_LEVELï¼‰

```javascript
const LOG_LEVEL = {
  OFF: 0,        // é—œé–‰ Log
  OPERATION: 1,  // ç‡Ÿé‹ç­‰ç´šï¼ˆé‡è¦æ“ä½œã€éŒ¯èª¤ï¼‰
  DEBUG: 2       // Debug ç­‰ç´šï¼ˆæ‰€æœ‰æ“ä½œã€è©³ç´°è³‡è¨Šï¼‰
};
```

**èªªæ˜Žï¼š**
- `OFF (0)` - å®Œå…¨é—œé–‰ Log è¨˜éŒ„
- `OPERATION (1)` - åªè¨˜éŒ„é‡è¦ç‡Ÿé‹è³‡è¨Šå’ŒéŒ¯èª¤
- `DEBUG (2)` - è¨˜éŒ„æ‰€æœ‰ç­‰ç´šçš„ Logï¼ˆåŒ…å«é™¤éŒ¯è³‡è¨Šï¼‰

---

## ðŸ”§ æ ¸å¿ƒå‡½æ•¸ï¼šlogToSheet()

### å‡½æ•¸ç°½ç« 
```javascript
function logToSheet(message, level = 'INFO', details = null)
```

### åƒæ•¸èªªæ˜Ž
| åƒæ•¸ | é¡žåž‹ | å¿…å¡« | èªªæ˜Ž | ç¯„ä¾‹ |
|------|------|------|------|------|
| `message` | String | âœ… | æ—¥èªŒè¨Šæ¯ | `'é–‹å§‹è§£æž Excel'` |
| `level` | String | â¬œ | æ—¥èªŒç­‰ç´š | `'DEBUG'`, `'INFO'`, `'WARNING'`, `'ERROR'`, `'OPERATION'` |
| `details` | Object | â¬œ | é¡å¤–è©³ç´°è³‡è¨Š | `{ fileName: 'test.xlsx', rowCount: 100 }` |

### åŸ·è¡Œæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. å–å¾—ç•¶å‰ Log ç­‰ç´šè¨­å®š            â”‚
â”‚     getLogLevel()                   â”‚
â”‚     å¾ž Script Properties è®€å–       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. æª¢æŸ¥æ˜¯å¦æ‡‰è©²è¨˜éŒ„                 â”‚
â”‚     if (currentLogLevel === OFF)    â”‚
â”‚        â†’ ç›´æŽ¥è¿”å›žï¼Œä¸è¨˜éŒ„            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. åˆ¤æ–· Log ç­‰ç´šæ˜¯å¦ç¬¦åˆ            â”‚
â”‚     checkShouldLog(level, current)  â”‚
â”‚     - OPERATION: åªè¨˜éŒ„ OPERATION/ERROR â”‚
â”‚     - DEBUG: è¨˜éŒ„æ‰€æœ‰               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. å–å¾—æˆ–å»ºç«‹ Log å·¥ä½œè¡¨            â”‚
â”‚     getOrCreateSheet('Log')         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. åˆå§‹åŒ–å·¥ä½œè¡¨ï¼ˆå¦‚æžœæ˜¯ç¬¬ä¸€æ¬¡ï¼‰      â”‚
â”‚     if (lastRow === 0)              â”‚
â”‚        initLogSheet()               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. å»ºç«‹ Log è¨˜éŒ„é™£åˆ—                â”‚
â”‚     [æ™‚é–“, ç­‰ç´š, è¨Šæ¯, ç’°å¢ƒ,         â”‚
â”‚      ä½¿ç”¨è€…, è©³ç´°è³‡è¨Š(JSON)]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7. å¯«å…¥ Google Sheets               â”‚
â”‚     sheet.appendRow(logEntry)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8. åŒæ­¥è¼¸å‡ºåˆ° Apps Script Logger    â”‚
â”‚     Logger.log(`[${level}] ${msg}`) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç¨‹å¼ç¢¼è©³è§£

```javascript
function logToSheet(message, level = 'INFO', details = null) {
  try {
    // ===== æ­¥é©Ÿ 1: å–å¾— Log ç­‰ç´š =====
    const currentLogLevel = getLogLevel();
    
    // ===== æ­¥é©Ÿ 2: æª¢æŸ¥æ˜¯å¦é—œé–‰ =====
    if (currentLogLevel === LOG_LEVEL.OFF) {
      return; // ä¸è¨˜éŒ„ä»»ä½• Log
    }
    
    // ===== æ­¥é©Ÿ 3: åˆ¤æ–·æ˜¯å¦æ‡‰è©²è¨˜éŒ„ =====
    const shouldLog = checkShouldLog(level, currentLogLevel);
    if (!shouldLog) {
      return; // æ­¤ç­‰ç´šçš„ Log ä¸ç¬¦åˆè¨˜éŒ„æ¢ä»¶
    }
    
    // ===== æ­¥é©Ÿ 4: å–å¾— Log å·¥ä½œè¡¨ =====
    const config = getConfig();
    const sheet = getOrCreateSheet('Log');
    
    // ===== æ­¥é©Ÿ 5: åˆå§‹åŒ–ï¼ˆç¬¬ä¸€æ¬¡ï¼‰ =====
    if (sheet.getLastRow() === 0) {
      initLogSheet(sheet); // å»ºç«‹æ¨™é¡Œåˆ—ä¸¦æ ¼å¼åŒ–
    }
    
    // ===== æ­¥é©Ÿ 6: å»ºç«‹ Log è¨˜éŒ„ =====
    const timestamp = new Date();
    const logEntry = [
      timestamp,                          // A æ¬„ï¼šæ™‚é–“
      level,                              // B æ¬„ï¼šç­‰ç´š
      message,                            // C æ¬„ï¼šè¨Šæ¯
      config.ENVIRONMENT,                 // D æ¬„ï¼šç’°å¢ƒ (test/production)
      Session.getEffectiveUser().getEmail(), // E æ¬„ï¼šä½¿ç”¨è€… Email
      details ? JSON.stringify(details) : '' // F æ¬„ï¼šè©³ç´°è³‡è¨Š (JSON)
    ];
    
    // ===== æ­¥é©Ÿ 7: å¯«å…¥ Google Sheets =====
    sheet.appendRow(logEntry);
    
    // ===== æ­¥é©Ÿ 8: è¼¸å‡ºåˆ° Apps Script Logger =====
    Logger.log(`[${level}] ${message}`);
    if (details) {
      Logger.log('Details: ' + JSON.stringify(details));
    }
    
  } catch (error) {
    // ===== éŒ¯èª¤è™•ç†ï¼šè‡³å°‘è¼¸å‡ºåˆ° Logger =====
    Logger.log('è¨˜éŒ„æ—¥èªŒå¤±æ•—: ' + error.message);
    Logger.log('åŽŸå§‹è¨Šæ¯: ' + message);
  }
}
```

---

## ðŸ“Š Log è¨˜éŒ„æ ¼å¼

### Google Sheets æ¬„ä½çµæ§‹

| æ¬„ä½ | åç¨± | è³‡æ–™é¡žåž‹ | èªªæ˜Ž | ç¯„ä¾‹ |
|------|------|---------|------|------|
| **A** | æ™‚é–“ | Date | è¨˜éŒ„æ™‚é–“æˆ³è¨˜ | `2026-02-06 10:30:45` |
| **B** | ç­‰ç´š | String | Log ç­‰ç´š | `DEBUG`, `INFO`, `WARNING`, `ERROR`, `OPERATION` |
| **C** | è¨Šæ¯ | String | ä¸»è¦è¨Šæ¯å…§å®¹ | `é–‹å§‹è§£æžæ³‰å¨åœ‹å®‰ç­è¡¨: 11501` |
| **D** | ç’°å¢ƒ | String | åŸ·è¡Œç’°å¢ƒ | `test` æˆ– `production` |
| **E** | ä½¿ç”¨è€… | String | åŸ·è¡Œè€… Email | `user@example.com` |
| **F** | è©³ç´°è³‡è¨Š | String (JSON) | é¡å¤–è©³ç´°è³‡æ–™ | `{"sheetName":"11501","rowCount":21}` |

### ç¯„ä¾‹è¨˜éŒ„

```
æ™‚é–“                  | ç­‰ç´š       | è¨Šæ¯                          | ç’°å¢ƒ | ä½¿ç”¨è€…           | è©³ç´°è³‡è¨Š
2026-02-06 10:30:45  | OPERATION  | é–‹å§‹è§£æžæ³‰å¨åœ‹å®‰ç­è¡¨: 11501    | test | user@gmail.com   | {"sheetName":"11501"}
2026-02-06 10:30:46  | DEBUG      | æ‰¾åˆ°çš„ç­åˆ¥ä»£ç¢¼                 | test | user@gmail.com   | {"shiftMap":{"A":{...}}}
2026-02-06 10:30:47  | DEBUG      | è³‡æ–™çµæ§‹é…ç½®                   | test | user@gmail.com   | {"config":{...}}
2026-02-06 10:30:50  | OPERATION  | æ³‰å¨åœ‹å®‰ç­è¡¨è§£æžå®Œæˆ           | test | user@gmail.com   | {"totalRecords":21}
```

---

## ðŸŽ›ï¸ Log ç­‰ç´šæŽ§åˆ¶æ©Ÿåˆ¶

### checkShouldLog() å‡½æ•¸

```javascript
function checkShouldLog(level, currentLogLevel) {
  // ç‡Ÿé‹ç­‰ç´š (1)ï¼šåªè¨˜éŒ„ OPERATION å’Œ ERROR
  if (currentLogLevel === LOG_LEVEL.OPERATION) {
    return (level === 'OPERATION' || level === 'ERROR');
  }
  
  // Debug ç­‰ç´š (2)ï¼šè¨˜éŒ„æ‰€æœ‰
  if (currentLogLevel === LOG_LEVEL.DEBUG) {
    return true;
  }
  
  // å…¶ä»–æƒ…æ³ä¸è¨˜éŒ„
  return false;
}
```

### Log ç­‰ç´šéŽæ¿¾è¦å‰‡

| è¨­å®šå€¼ | Log_Level | è¨˜éŒ„çš„ Log ç­‰ç´š | èªªæ˜Ž |
|--------|-----------|----------------|------|
| `0` | OFF | ç„¡ | å®Œå…¨ä¸è¨˜éŒ„ |
| `1` | OPERATION | `OPERATION`, `ERROR` | åªè¨˜éŒ„é‡è¦æ“ä½œå’ŒéŒ¯èª¤ |
| `2` | DEBUG | æ‰€æœ‰ç­‰ç´š | è¨˜éŒ„ DEBUG, INFO, WARNING, ERROR, OPERATION |

### éŽæ¿¾ç¤ºæ„åœ–

```
Log_Level = 0 (OFF)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEBUG   â”‚ INFO    â”‚ WARNING â”‚ ERROR   â”‚OPERATIONâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   âŒ    â”‚   âŒ    â”‚   âŒ    â”‚   âŒ    â”‚   âŒ    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Log_Level = 1 (OPERATION)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEBUG   â”‚ INFO    â”‚ WARNING â”‚ ERROR   â”‚OPERATIONâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   âŒ    â”‚   âŒ    â”‚   âŒ    â”‚   âœ…    â”‚   âœ…    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Log_Level = 2 (DEBUG)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ DEBUG   â”‚ INFO    â”‚ WARNING â”‚ ERROR   â”‚OPERATIONâ”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   âœ…    â”‚   âœ…    â”‚   âœ…    â”‚   âœ…    â”‚   âœ…    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ› ï¸ ä¾¿åˆ©å‡½æ•¸

### å¿«é€Ÿè¨˜éŒ„å‡½æ•¸

```javascript
// 1. DEBUG ç­‰ç´šï¼ˆé™¤éŒ¯è³‡è¨Šï¼‰
logDebug(message, details);
// ç¯„ä¾‹ï¼šlogDebug('é–‹å§‹è§£æž', { fileName: 'test.xlsx' });

// 2. INFO ç­‰ç´šï¼ˆä¸€èˆ¬è³‡è¨Šï¼‰
logInfo(message, details);
// ç¯„ä¾‹ï¼šlogInfo('æª”æ¡ˆä¸Šå‚³æˆåŠŸ', { size: 1024 });

// 3. WARNING ç­‰ç´šï¼ˆè­¦å‘Šè¨Šæ¯ï¼‰
logWarning(message, details);
// ç¯„ä¾‹ï¼šlogWarning('ç„¡æ³•å–å¾—å¹´æœˆä»½', { yearMonth: '2026/01' });

// 4. ERROR ç­‰ç´šï¼ˆéŒ¯èª¤è¨Šæ¯ï¼‰
logError(message, details);
// ç¯„ä¾‹ï¼šlogError('è§£æžå¤±æ•—', { error: error.toString() });

// 5. OPERATION ç­‰ç´šï¼ˆé‡è¦ç‡Ÿé‹è³‡è¨Šï¼‰
logOperation(message, details);
// ç¯„ä¾‹ï¼šlogOperation('è§£æžå®Œæˆ', { totalRecords: 100 });
```

### å¯¦éš›ä½¿ç”¨ç¯„ä¾‹

```javascript
// ExcelParser.gs ä¸­çš„ä½¿ç”¨
function parseQuanWeiSchedule(data, sheetName) {
  // é–‹å§‹é‡è¦æ“ä½œ
  logOperation(`é–‹å§‹è§£æžæ³‰å¨åœ‹å®‰ç­è¡¨: ${sheetName}`);
  
  // é™¤éŒ¯è³‡è¨Š
  const shiftMap = buildShiftMap(data);
  logDebug('æ‰¾åˆ°çš„ç­åˆ¥ä»£ç¢¼', { shiftMap: shiftMap });
  
  // è³‡æ–™çµæ§‹è³‡è¨Š
  const config = locateDataStructure(data);
  logDebug('è³‡æ–™çµæ§‹é…ç½®', { config: config });
  
  // è­¦å‘Šè¨Šæ¯
  if (!yearMonth.includes('/')) {
    logWarning('ç„¡æ³•å–å¾—å¹´æœˆä»½ï¼Œä½¿ç”¨é è¨­å€¼', { yearMonth: yearMonth });
  }
  
  // å®Œæˆé‡è¦æ“ä½œ
  logOperation(`æ³‰å¨åœ‹å®‰ç­è¡¨è§£æžå®Œæˆ`, {
    sheetName: sheetName,
    totalRecords: finalResults.length,
    totalEmployees: processedEmployees
  });
}
```

---

## ðŸŽ¨ Log Sheet åˆå§‹åŒ–

### initLogSheet() å‡½æ•¸

```javascript
function initLogSheet(sheet) {
  // 1. è¨­å®šæ¨™é¡Œåˆ—
  const headers = ['æ™‚é–“', 'ç­‰ç´š', 'è¨Šæ¯', 'ç’°å¢ƒ', 'ä½¿ç”¨è€…', 'è©³ç´°è³‡è¨Š'];
  sheet.getRange(1, 1, 1, headers.length).setValues([headers]);
  
  // 2. æ ¼å¼åŒ–æ¨™é¡Œåˆ—
  const headerRange = sheet.getRange(1, 1, 1, headers.length);
  headerRange.setBackground('#434343');      // æ·±ç°è‰²èƒŒæ™¯
  headerRange.setFontColor('#ffffff');       // ç™½è‰²æ–‡å­—
  headerRange.setFontWeight('bold');         // ç²—é«”
  headerRange.setHorizontalAlignment('center'); // ç½®ä¸­å°é½Š
  
  // 3. å‡çµæ¨™é¡Œåˆ—
  sheet.setFrozenRows(1);
  
  // 4. è¨­å®šæ¬„å¯¬
  sheet.setColumnWidth(1, 150); // æ™‚é–“
  sheet.setColumnWidth(2, 100); // ç­‰ç´š
  sheet.setColumnWidth(3, 300); // è¨Šæ¯
  sheet.setColumnWidth(4, 80);  // ç’°å¢ƒ
  sheet.setColumnWidth(5, 150); // ä½¿ç”¨è€…
  sheet.setColumnWidth(6, 400); // è©³ç´°è³‡è¨Š
}
```

### è¦–è¦ºæ•ˆæžœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      æ™‚é–“       â”‚  ç­‰ç´š   â”‚        è¨Šæ¯          â”‚ ç’°å¢ƒ â”‚   ä½¿ç”¨è€…     â”‚   è©³ç´°è³‡è¨Š      â”‚
â”‚   (æ·±ç°åº•ç™½å­—)   â”‚         â”‚                      â”‚      â”‚              â”‚                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2026-02-06 10:30â”‚OPERATIONâ”‚é–‹å§‹è§£æžæ³‰å¨åœ‹å®‰ç­è¡¨   â”‚ test â”‚user@gmail.comâ”‚{"sheetName":... â”‚
â”‚ 2026-02-06 10:31â”‚ DEBUG   â”‚æ‰¾åˆ°çš„ç­åˆ¥ä»£ç¢¼         â”‚ test â”‚user@gmail.comâ”‚{"shiftMap":{... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ§¹ Log æ¸…ç†åŠŸèƒ½

### cleanOldLogs() å‡½æ•¸

```javascript
function cleanOldLogs(daysToKeep = 30) {
  const sheet = getOrCreateSheet('Log');
  const lastRow = sheet.getLastRow();
  
  // è®€å–æ™‚é–“æ¬„ï¼ˆA æ¬„ï¼‰
  const data = sheet.getRange(2, 1, lastRow - 1, 1).getValues();
  
  // è¨ˆç®—æˆªæ­¢æ—¥æœŸ
  const cutoffDate = new Date();
  cutoffDate.setDate(cutoffDate.getDate() - daysToKeep);
  
  // å¾žå¾Œå¾€å‰åˆªé™¤èˆŠè¨˜éŒ„
  let deleteCount = 0;
  for (let i = data.length - 1; i >= 0; i--) {
    const logDate = new Date(data[i][0]);
    if (logDate < cutoffDate) {
      sheet.deleteRow(i + 2); // +2 å› ç‚ºæœ‰æ¨™é¡Œåˆ—
      deleteCount++;
    }
  }
  
  logOperation(`æ¸…ç† Log å®Œæˆï¼Œåˆªé™¤ ${deleteCount} ç­†èˆŠè³‡æ–™ï¼ˆ${daysToKeep} å¤©å‰ï¼‰`);
}
```

**ä½¿ç”¨æ–¹å¼ï¼š**
```javascript
// æ¸…ç† 30 å¤©å‰çš„ Logï¼ˆé è¨­ï¼‰
cleanOldLogs();

// æ¸…ç† 7 å¤©å‰çš„ Log
cleanOldLogs(7);

// æ¸…ç† 90 å¤©å‰çš„ Log
cleanOldLogs(90);
```

---

## ðŸ“ˆ å°ˆæ¡ˆä¸­çš„ Log ä½¿ç”¨çµ±è¨ˆ

### Log ä½¿ç”¨åˆ†å¸ƒ

| æª”æ¡ˆ | DEBUG | INFO | WARNING | ERROR | OPERATION | ç¸½è¨ˆ |
|------|-------|------|---------|-------|-----------|------|
| ExcelParser.gs | 8 | 1 | 1 | 2 | 3 | 15 |
| Code.gs | 5 | 0 | 2 | 2 | 2 | 11 |
| SheetService.gs | 1 | 1 | 0 | 1 | 0 | 3 |
| **ç¸½è¨ˆ** | **14** | **2** | **3** | **5** | **5** | **29** |

### Log ç­‰ç´šä½¿ç”¨æ¯”ä¾‹

```
DEBUG     : â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 48.3% (14 æ¬¡)
ERROR     : â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 17.2% (5 æ¬¡)
OPERATION : â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 17.2% (5 æ¬¡)
WARNING   : â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10.3% (3 æ¬¡)
INFO      : â–ˆâ–ˆâ–ˆ 6.9% (2 æ¬¡)
```

---

## ðŸŽ¯ æœ€ä½³å¯¦è¸

### 1. é¸æ“‡æ­£ç¢ºçš„ Log ç­‰ç´š

```javascript
// âœ… æ­£ç¢ºä½¿ç”¨
logOperation('é–‹å§‹è™•ç†ä¸Šå‚³');           // é‡è¦æ“ä½œé–‹å§‹
logDebug('æ‰¾åˆ°çš„ç­åˆ¥ä»£ç¢¼', { map });    // é™¤éŒ¯è³‡è¨Š
logWarning('ç„¡æ³•å–å¾—å¹´æœˆä»½');           // è­¦å‘Šä½†ä¸å½±éŸ¿åŸ·è¡Œ
logError('è§£æžå¤±æ•—', { error });        // éŒ¯èª¤ç™¼ç”Ÿ
logOperation('è™•ç†å®Œæˆ', { count });    // é‡è¦æ“ä½œå®Œæˆ

// âŒ éŒ¯èª¤ä½¿ç”¨
logError('è™•ç†å®Œæˆ');                   // ä¸æ˜¯éŒ¯èª¤ï¼Œæ‡‰ç”¨ OPERATION
logOperation('è®Šæ•¸å€¼: ' + value);       // å¤ªç´°ç¯€ï¼Œæ‡‰ç”¨ DEBUG
logDebug('æª”æ¡ˆä¸Šå‚³å¤±æ•—');               // æ˜¯éŒ¯èª¤ï¼Œæ‡‰ç”¨ ERROR
```

### 2. æä¾›æœ‰ç”¨çš„è©³ç´°è³‡è¨Š

```javascript
// âœ… å¥½çš„åšæ³•
logOperation('æª”æ¡ˆè™•ç†æˆåŠŸ', {
  fileName: fileName,
  rowCount: rowCount,
  processTime: '2.5 ç§’',
  shiftCodes: 'A, B, O'
});

// âŒ ä¸å¥½çš„åšæ³•
logOperation('è™•ç†æˆåŠŸ');  // ç¼ºå°‘ç´°ç¯€
logOperation('æˆåŠŸ', fileName);  // details æ‡‰è©²æ˜¯ç‰©ä»¶
```

### 3. åœ¨é—œéµä½ç½®è¨˜éŒ„ Log

```javascript
function processFile() {
  // é–‹å§‹æ“ä½œ
  logOperation('é–‹å§‹è™•ç†æª”æ¡ˆ', { fileName });
  
  try {
    // é‡è¦æ­¥é©Ÿ
    const data = parseFile();
    logDebug('è§£æžå®Œæˆ', { rowCount: data.length });
    
    const result = validateData(data);
    if (result.warnings.length > 0) {
      logWarning('ç™¼ç¾è­¦å‘Š', { warnings: result.warnings });
    }
    
    // å®Œæˆæ“ä½œ
    logOperation('è™•ç†å®Œæˆ', { success: true });
    
  } catch (error) {
    // éŒ¯èª¤è™•ç†
    logError('è™•ç†å¤±æ•—', { error: error.toString() });
    throw error;
  }
}
```

---

## âš™ï¸ è¨­å®š Log ç­‰ç´š

### Script Properties è¨­å®š

```javascript
// åœ¨ GAS å°ˆæ¡ˆè¨­å®šä¸­ï¼š
// 1. é»žæ“Šã€Œå°ˆæ¡ˆè¨­å®šã€ï¼ˆé½’è¼ªåœ–ç¤ºï¼‰
// 2. åœ¨ã€ŒæŒ‡ä»¤ç¢¼å±¬æ€§ã€å€å¡Šæ–°å¢žï¼š

å±¬æ€§åç¨±: Log_Level
å€¼: 0  // OFF - é—œé–‰
å€¼: 1  // OPERATION - ç‡Ÿé‹ç­‰ç´š
å€¼: 2  // DEBUG - é™¤éŒ¯ç­‰ç´šï¼ˆé è¨­ï¼‰
```

### å»ºè­°è¨­å®š

| ç’°å¢ƒ | Log_Level | ç†ç”± |
|------|-----------|------|
| **é–‹ç™¼ç’°å¢ƒ** | `2` (DEBUG) | éœ€è¦è©³ç´°è³‡è¨Šé™¤éŒ¯ |
| **æ¸¬è©¦ç’°å¢ƒ** | `2` (DEBUG) | é©—è­‰åŠŸèƒ½æ­£ç¢ºæ€§ |
| **æ­£å¼ç’°å¢ƒï¼ˆåˆæœŸï¼‰** | `2` (DEBUG) | è§€å¯Ÿç³»çµ±é‹ä½œ |
| **æ­£å¼ç’°å¢ƒï¼ˆç©©å®šï¼‰** | `1` (OPERATION) | åªè¨˜éŒ„é‡è¦æ“ä½œï¼Œæ¸›å°‘è³‡æ–™é‡ |
| **æ•ˆèƒ½æ¸¬è©¦** | `0` (OFF) | é¿å… Log å½±éŸ¿æ•ˆèƒ½ |

---

## ðŸ” æŸ¥è©¢å’Œåˆ†æž Log

### å¸¸ç”¨ç¯©é¸

**1. åªçœ‹éŒ¯èª¤è¨˜éŒ„ï¼š**
- åœ¨ã€Œç­‰ç´šã€æ¬„å¥—ç”¨ç¯©é¸å™¨
- å‹¾é¸ `ERROR`

**2. æŸ¥çœ‹ç‰¹å®šæ™‚é–“ç¯„åœï¼š**
- åœ¨ã€Œæ™‚é–“ã€æ¬„å¥—ç”¨ç¯©é¸å™¨
- é¸æ“‡æ—¥æœŸç¯„åœ

**3. æŸ¥çœ‹ç‰¹å®šæ“ä½œï¼š**
- åœ¨ã€Œè¨Šæ¯ã€æ¬„ä½¿ç”¨æœå°‹åŠŸèƒ½
- è¼¸å…¥é—œéµå­—ï¼ˆå¦‚ã€Œè§£æžã€ï¼‰

**4. æŸ¥çœ‹è©³ç´°è³‡è¨Šï¼š**
- é»žæ“Šã€Œè©³ç´°è³‡è¨Šã€æ¬„çš„ JSON å­—ä¸²
- è¤‡è£½åˆ° JSON æ ¼å¼åŒ–å·¥å…·æŸ¥çœ‹

### Google Sheets å…¬å¼ç¯„ä¾‹

```javascript
// è¨ˆç®—éŒ¯èª¤æ•¸é‡
=COUNTIF(B:B, "ERROR")

// è¨ˆç®—ä»Šå¤©çš„ Log æ•¸é‡
=COUNTIFS(A:A, ">="&TODAY(), A:A, "<"&TODAY()+1)

// æå–æœ€æ–° 10 ç­† Log
=QUERY(A:F, "ORDER BY A DESC LIMIT 10")
```

---

## ðŸ“Š æ•ˆèƒ½è€ƒé‡

### Log å¯«å…¥æ•ˆèƒ½

| é …ç›® | æ•¸å€¼ | èªªæ˜Ž |
|------|------|------|
| å–®æ¬¡å¯«å…¥æ™‚é–“ | ~100-200ms | appendRow() æ“ä½œ |
| JSON stringify | ~1-5ms | details ç‰©ä»¶è½‰æ› |
| ç¸½é«”å½±éŸ¿ | æœ€å° | æŽ¡ç”¨éžåŒæ­¥å¯«å…¥ |

### å„ªåŒ–å»ºè­°

1. **ä½¿ç”¨é©ç•¶çš„ Log ç­‰ç´š**
   - æ­£å¼ç’°å¢ƒä½¿ç”¨ OPERATION (1)
   - é¿å…éŽåº¦è¨˜éŒ„ DEBUG

2. **å®šæœŸæ¸…ç†èˆŠ Log**
   ```javascript
   // æ¯æœˆåŸ·è¡Œä¸€æ¬¡
   cleanOldLogs(30);
   ```

3. **é¿å…åœ¨è¿´åœˆä¸­éŽåº¦è¨˜éŒ„**
   ```javascript
   // âŒ ä¸å¥½
   for (let i = 0; i < 1000; i++) {
     logDebug('è™•ç†ç¬¬ ' + i + ' ç­†');  // ç”¢ç”Ÿ 1000 ç­† Log
   }
   
   // âœ… å¥½
   logDebug('é–‹å§‹è™•ç† 1000 ç­†è³‡æ–™');
   for (let i = 0; i < 1000; i++) {
     // è™•ç†...
   }
   logDebug('è™•ç†å®Œæˆ', { count: 1000 });
   ```

---

## âœ… ç¸½çµ

### Log ç³»çµ±ç‰¹è‰²

âœ… **5 å€‹ Log ç­‰ç´š** - DEBUG, INFO, WARNING, ERROR, OPERATION  
âœ… **3 ç¨®æŽ§åˆ¶æ¨¡å¼** - OFF, OPERATION, DEBUG  
âœ… **é›™è¼¸å‡ºæ©Ÿåˆ¶** - Google Sheets + Apps Script Logger  
âœ… **è‡ªå‹•åˆå§‹åŒ–** - ç¬¬ä¸€æ¬¡ä½¿ç”¨è‡ªå‹•å»ºç«‹æ ¼å¼åŒ–å·¥ä½œè¡¨  
âœ… **è©³ç´°è³‡è¨Šæ”¯æ´** - JSON æ ¼å¼å„²å­˜é¡å¤–è³‡æ–™  
âœ… **ä¾¿åˆ©å‡½æ•¸** - 5 å€‹å¿«é€Ÿè¨˜éŒ„å‡½æ•¸  
âœ… **æ¸…ç†åŠŸèƒ½** - è‡ªå‹•æ¸…ç†èˆŠ Log  
âœ… **éŒ¯èª¤å®¹éŒ¯** - Log å¤±æ•—ä¸å½±éŸ¿ä¸»ç¨‹å¼  

### æ ¸å¿ƒå„ªå‹¢

1. **å¯è¿½æº¯æ€§** - æ‰€æœ‰æ“ä½œéƒ½æœ‰å®Œæ•´è¨˜éŒ„
2. **å¯æŽ§æ€§** - é€éŽ Script Properties å‹•æ…‹èª¿æ•´ç­‰ç´š
3. **å¯è®€æ€§** - çµæ§‹åŒ–è³‡æ–™ï¼Œæ˜“æ–¼æŸ¥è©¢åˆ†æž
4. **å¯ç¶­è­·æ€§** - æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œä¾¿æ–¼æ“´å……

---

**æ–‡ä»¶ç‰ˆæœ¬ï¼š** v1.0  
**å»ºç«‹æ™‚é–“ï¼š** 2026-02-06  
**å°æ‡‰å°ˆæ¡ˆç‰ˆæœ¬ï¼š** v0.6
